{% extends 'base.html' %}
{% load static %}

{% block title %} {{ course.title }} - {{ lesson.title }} {% endblock %}
{% block extra_css %}
<style>
    body {
        font-family: "Vazir", sans-serif;
        background-color: #f9fafb;
    }
    .accordion-content {
        transition: all 0.3s ease;
    }
</style>
{% endblock %}


{% block content %}

<!-- ðŸ”¹ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
<main class="flex flex-col md:flex-row gap-6">

    <!-- ðŸ”¸ Ø³ØªÙˆÙ† Ù…Ù†Ùˆ -->
    <aside class="w-full md:w-2/5 lg:w-1/3 bg-gradient-to-b from-white to-gray-50
              rounded-3xl shadow-lg p-5 sticky top-4 max-h-[85vh] overflow-y-auto">

        <h2 class="text-xl font-bold mb-6 text-center text-gray-800">
            ðŸ“š Ù…Ø­ØªÙˆØ§ÛŒ Ø¯ÙˆØ±Ù‡
        </h2>

        {% for chapter in chapters %}
        <div class="mb-4">

            <!-- ÙØµÙ„ -->
            <button onclick="toggleLessons('{{ chapter.id }}')"
                    class="w-full flex justify-between items-center text-right
                       bg-gray-100 hover:bg-blue-50 transition rounded-xl px-4 py-3
                       font-semibold text-gray-800">
                <span style="font-size:200%">ðŸ“˜ {{ forloop.counter }}: {{ chapter.title }}</span>
                <span id="icon-{{ chapter.id }}" class="text-sm">â–¼</span>
            </button>

            <!-- Ø¯Ø±Ø³â€ŒÙ‡Ø§ -->
            <div id="chapter-{{ chapter.id }}"
                 class="accordion-content mt-3 space-y-1
                    {% if lesson.chapter.id == chapter.id %}block{% else %}hidden{% endif %}">

                {% for l in chapter.lessons.all %}
                <a style="font-size:120%" href="{% url 'courses:lesson_detail' course_slug=course.slug lesson_slug=l.slug %}"
   class="flex items-center gap-2 px-4 py-2 rounded-lg text-sm transition duration-200
   {% if l.id == lesson.id %}
       bg-yellow-300 text-black font-bold shadow
   {% else %}
       bg-white text-gray-700 hover:bg-yellow-300 hover:text-black
   {% endif %}">
    â–¶ {{ forloop.parentloop.counter }}.{{ forloop.counter }} - {{ l.title }}
</a>


                {% endfor %}

            </div>
        </div>
        {% endfor %}
    </aside>


    <!-- ðŸ”¸ Ø¨Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ -->
    <section class="flex-1 bg-white rounded-2xl shadow p-4">
        <h2 class="text-xl font-bold mb-4 text-gray-800">{{ lesson.title }}</h2>

        {% if lesson.video %}
        <div class="mb-4">
            <video width="100%" height="400" controls controlsList="nodownload" class="rounded-lg shadow"
                   oncontextmenu="return false;">
                <source src="{{ lesson.video }}" type="video/mp4">
                Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ ÙˆÛŒØ¯ÛŒÙˆ Ø±Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
            </video>
        </div>
        {% endif %}

        <article class="text-gray-700 leading-relaxed">
            {{ lesson.description|linebreaks }}
        </article>
    </section>

</main>

<!-- ðŸ”¹ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª -->
<script>
    function toggleLessons(id) {
        const content = document.getElementById('chapter-' + id);
        const icon = document.getElementById('icon-' + id);

        if (content.classList.contains('hidden')) {
            content.classList.remove('hidden');
            icon.textContent = 'â–²';
        } else {
            content.classList.add('hidden');
            icon.textContent = 'â–¼';
        }
    }
</script>

{% endblock content %}

{% block extra_js %}
<script src="https://cdn.tailwindcss.com"></script>
{% endblock %}