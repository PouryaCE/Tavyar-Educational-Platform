<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ course.title }} - {{ lesson.title }}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: "Vazir", sans-serif;
            background-color: #f9fafb;
        }
        .accordion-content {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="p-6">

    <!-- ğŸ”¹ Ù‡Ø¯Ø± -->
    <header class="mb-6 flex justify-between items-center border-b pb-3">
        <h1 class="text-2xl font-bold text-gray-800">{{ course.title }}</h1>
        <a href="/" class="text-blue-600 hover:underline">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
    </header>

    <!-- ğŸ”¹ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
    <main class="flex flex-col md:flex-row gap-6">

        <!-- ğŸ”¸ Ø³ØªÙˆÙ† Ù…Ù†Ùˆ -->
        <aside class="w-full md:w-1/3 bg-white rounded-2xl shadow p-4 h-fit sticky top-4">
            <h2 class="text-lg font-semibold mb-4 text-center text-gray-700">ÙØµÙ„â€ŒÙ‡Ø§ Ùˆ Ø¯Ø±Ø³â€ŒÙ‡Ø§</h2>

            {% for chapter in chapters %}
            <div class="mb-3 border-b border-gray-200 pb-2">
                <button onclick="toggleLessons('{{ chapter.id }}')"
                        class="w-full text-right font-semibold flex justify-between items-center text-gray-800 hover:text-blue-600">
                    {{ chapter.title }}
                    <span id="icon-{{ chapter.id }}">â–¼</span>
                </button>

                <div id="chapter-{{ chapter.id }}"
                     class="accordion-content overflow-hidden {% if lesson.chapter.id == chapter.id %}block{% else %}hidden{% endif %} mt-2 pl-2">
                    {% for l in chapter.lessons.all %}
                    <a href="{% url 'courses:lesson_detail' course_slug=course.slug lesson_slug=l.slug %}"
                       class="block py-1 text-sm rounded-md px-2 transition
                              {% if l.id == lesson.id %}
                                  bg-blue-100 text-blue-700 font-bold
                              {% else %}
                                  hover:bg-gray-100 text-gray-700
                              {% endif %}">
                        {{ l.title }}
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </aside>

        <!-- ğŸ”¸ Ø¨Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ -->
        <section class="flex-1 bg-white rounded-2xl shadow p-4">
            <h2 class="text-xl font-bold mb-4 text-gray-800">{{ lesson.title }}</h2>

            {% if lesson.video %}
            <div class="mb-4">
                  <video width="100%" height="400" controls controlsList="nodownload" class="rounded-lg shadow"
                        oncontextmenu="return false;">
                      <source src="{{ lesson.video }}" type="video/mp4">
                      Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ ÙˆÛŒØ¯ÛŒÙˆ Ø±Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
                  </video>
            </div>
            {% endif %}

            <article class="text-gray-700 leading-relaxed">
                {{ lesson.description|linebreaks }}
            </article>
        </section>

    </main>

    <!-- ğŸ”¹ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª -->
    <script>
    function toggleLessons(id) {
        const content = document.getElementById('chapter-' + id);
        const icon = document.getElementById('icon-' + id);

        if (content.classList.contains('hidden')) {
            content.classList.remove('hidden');
            icon.textContent = 'â–²';
        } else {
            content.classList.add('hidden');
            icon.textContent = 'â–¼';
        }
    }
    </script>

</body>
</html>
